@startuml
skinparam componentStyle rectangle
skinparam shadowing false
title SmartAuth - Diagram komponentów

package "Orkiestracja Aspire" {
  [SmartAuth.AppHost] as AppHost
}

package "Aplikacje" {
  [SmartAuth.Web\n(host ASP.NET dla statycznego frontendu)] as Web
  [SmartAuth.Web/ClientApp\n(SPA React + Vite)] as ClientApp
  [SmartAuth.Api\n(Minimal API)] as Api
}

package "Biblioteki rdzeniowe" {
  [SmartAuth.ServiceDefaults\n(Health/OpenTelemetry/Discovery)] as ServiceDefaults
  [SmartAuth.Infrastructure\n(EF Core + biometria + bezpieczeństwo)] as Infra
  [SmartAuth.Domain\n(encje/enumy)] as Domain
}

database "PostgreSQL authdb\n(obraz pgvector/pgvector:pg17)" as Postgres

package "Jakość" {
  [SmartAuth.Tests] as Tests
}

AppHost --> Web : AddProject("web")
AppHost --> Api : AddProject("apiservice")
AppHost --> Postgres : AddPostgres()+AddDatabase("authdb")

Web --> ClientApp : serwuje zbudowane zasoby SPA
ClientApp --> Api : /api/auth/*

Web ..> ServiceDefaults
Api ..> ServiceDefaults

Api --> Infra
Infra --> Domain
Infra --> Postgres : Npgsql + EF Core

Tests ..> Api : testy integracyjne i feature

note right of Api
- Endpointy auth: register/login/2fa
- JWT dostępowy + token tymczasowy
- Handlery face/voice/TOTP
end note
@enduml
