// Referencje plików workspace:
// - [SmartAuth.Web](SmartAuth.Web/)
// - [`Program`](SmartAuth.Api/Program.cs)
// - [SmartAuth.Infrastructure](SmartAuth.Infrastructure/)
// - [SmartAuth.Domain](SmartAuth.Domain/)
// - [README.md](README.md)
// - [AGENTS.md](AGENTS.md)

@startuml
actor User as Użytkownik
participant SPA as "SPA\n[SmartAuth.Web/ClientApp]"
participant Api as "Api\n[SmartAuth.Api/Program.cs]"
participant DB as "Auth DB\n(Postgres / pgvector)"
participant TwoFA as "Usługa 2FA\n(zachowanie deweloperskie)"

note over Api,TwoFA
  Część logiki 2FA może działać
  jako zachowanie deweloperskie.
end note

Użytkownik -> SPA : Otwiera aplikację i podaje email + hasło
SPA -> Api : POST /login { email, password }
Api -> Api : Waliduje poświadczenia\n(używa SmartAuth.Infrastructure i SmartAuth.Domain)
Api -> DB : Odczyt użytkownika i wymagań 2FA

alt 2FA wymagane
  Api --> SPA : 200 { temp_jwt, available_2fa_methods }
  SPA -> Api : POST /2fa/verify { method, code, temp_jwt }
  Api -> TwoFA : Weryfikacja kodu (zachowanie deweloperskie)
  TwoFA --> Api : wynik weryfikacji
  Api --> SPA : 200 { access_jwt }
else 2FA niewymagane
  Api --> SPA : 200 { access_jwt }
end

SPA -> Użytkownik : Zapisuje access_jwt i przechodzi dalej
@enduml
